stages:
  - test
  - build
  - release

before_script:
  - echo "=== Loading our self-signed CA certificate into Trust Store ==="
  - cat "$CA_SS_CERT" > /usr/local/share/ca-certificates/our.crt && update-ca-certificates
  - echo "==============================================================="
  - dotnet --version

test:all:
  image: "mcr.microsoft.com/dotnet/core/sdk:3.1"
  stage: test
  script:
    - dotnet test HellowTest/HellowTest.csproj

build:hellow:
  image: "mcr.microsoft.com/dotnet/core/sdk:3.1"
  stage: build
  script:
    - dotnet publish -c Release -o publish hellow/hellow.csproj
  tags:
    - docker
  only:
    refs:
      - develop
  artifacts:
    paths:
      - publish/

build:hellowapi:
  image: "mcr.microsoft.com/dotnet/core/sdk:3.1"
  stage: build
  script:
    - dotnet publish -c Release -o publish hellowapi/hellowapi.csproj
  tags:
    - docker
  only:
    refs:
      - develop
  artifacts:
    paths:
      - publish/

package:publish:
  image: "mcr.microsoft.com/dotnet/core/sdk:3.1"
  stage: release
  script:
    - dotnet pack
  tags:
    - docker
  only:
    refs:
      - develop
